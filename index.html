<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>גאלה 2025 | Gala 2025 - רישום</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f5f5;
      direction: rtl;
    }
    .container {
      max-width: 900px;
      margin: 30px auto;
      background: #ffffff;
      padding: 30px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      border-radius: 8px;
    }
    .logo {
      text-align: center;
      margin-bottom: 15px;
    }
    .logo img {
      max-width: 250px;
      height: auto;
    }
    h1 {
      text-align: center;
      margin: 5px 0 20px 0;
      line-height: 1.4;
    }
    h2 {
      margin-top: 25px;
      border-bottom: 1px solid #ddd;
      padding-bottom: 4px;
      font-size: 1.1rem;
    }
    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
      font-size: 0.95rem;
    }
    input, select {
      width: 100%;
      padding: 8px;
      margin-top: 4px;
      box-sizing: border-box;
      font-size: 0.95rem;
    }
    .participants {
      margin-top: 15px;
    }
    .participant-card {
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 15px;
      margin-bottom: 10px;
      background: #fafafa;
    }
    .participant-title {
      font-weight: bold;
      margin-bottom: 10px;
    }
    .row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .row > div {
      flex: 1;
      min-width: 180px;
    }
    .actions {
      margin-top: 25px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
    }
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      text-decoration: none;
      display: inline-block;
      font-size: 0.95rem;
    }
    .btn-add {
      background: #e0e0e0;
    }
    .btn-submit {
      background: #b31b1b;
      color: #fff;
    }
    .note {
      font-size: 0.9em;
      color: #555;
      margin-top: 8px;
    }
    .total-amount {
      font-weight: bold;
      font-size: 1rem;
      margin-top: 10px;
    }
    .policy {
      margin-top: 25px;
      font-size: 0.9rem;
      border-top: 1px solid #ddd;
      padding-top: 10px;
      color: #444;
    }
  </style>
</head>
<body>
  <div class="container">

    <!-- לוגו -->
    <div class="logo">
      <img src="New Gala Logo 2022.png" alt="Gala 2025 Logo" />
    </div>

    <!-- כותרת -->
    <h1>
      גאלה 2025<br />
      <span style="font-size: 0.9em;">Gala 2025</span>
    </h1>

    <form id="registrationForm">

      <!-- פרטי המזמין -->
      <h2>פרטי המזמין / Registrant Details</h2>

      <label>
        שם פרטי / First Name
        <input type="text" name="primary_first_name" required />
      </label>

      <label>
        שם משפחה / Last Name
        <input type="text" name="primary_last_name" required />
      </label>

      <label>
        דוא"ל / Email
        <input type="email" name="primary_email" required />
      </label>

      <label>
        טלפון / Phone
        <input type="tel" name="primary_phone" />
      </label>

      <label>
        כמות כרטיסים / Number of Tickets
        <input type="number" id="ticketCount" min="1" value="1" />
      </label>

      <!-- משתתף ראשון = המזמין -->
      <div class="participants">
        <div class="participant-card">
          <div class="participant-title">משתתף 1 (המזמין) / Participant 1 (Registrant)</div>

          <label>
            אוניברסיטה / University
            <input type="text" id="primary_participant_university" required />
          </label>

          <div class="row">
            <div>
              <label>
                סוג משתתף / Participant Type
                <select id="primary_participant_type" required>
                  <option value="">בחר / Select</option>
                  <option value="student">סטודנט / בוגר טרי (2023+) – 300 ₪</option>
                  <option value="veteran">בוגר ותיק – 360 ₪</option>
                </select>
              </label>
            </div>

            <div>
              <label>
                תעריף (₪) / Rate (NIS)
                <input type="number" id="primary_participant_rate" readonly />
              </label>
            </div>
          </div>
        </div>

        <!-- משתתפים נוספים -->
        <div id="extraParticipantsContainer"></div>

      </div>

      <div class="actions">
        <button type="button" class="btn btn-add" id="addParticipantBtn">הוסף משתתף נוסף / Add Participant</button>

        <div class="total-amount" id="totalAmount">סה״כ: 0 ₪</div>

        <button type="button" class="btn btn-submit" id="submitBtn">
          שליחת רישום (ללא תשלום)
        </button>
      </div>

      <!-- דמי ביטול -->
      <div class="policy">
        <strong>דמי ביטול:</strong><br />
        ביטול עד 72 שעות לפני האירוע – חיוב 6%.<br />
        ביטול בתוך 72 שעות לפני האירוע – אין החזרים.
        <br /><br />
        <strong>Cancellation Policy:</strong><br />
        Up to 72 hours before event: 6% fee.<br />
        Within 72 hours: no refunds.
      </div>

    </form>
  </div>

<script>
/* ה-Webhook שלך */
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycby_WagRoHeeBQFSItvbqIPWXEhf2HzFCw9ERLLZEdhqkMeOJB5vBomB1sgGZQq2lQEZ/exec";

/* פונקציית תעריף */
function getRateForType(type) {
  return type === "student" ? 300 : type === "veteran" ? 360 : 0;
}

const ticketCountInput = document.getElementById("ticketCount");
const primaryType = document.getElementById("primary_participant_type");
const primaryRate = document.getElementById("primary_participant_rate");
const totalAmountEl = document.getElementById("totalAmount");
const extraContainer = document.getElementById("extraParticipantsContainer");

/* עדכון מחיר למשתתף 1 */
primaryType.addEventListener("change", () => {
  primaryRate.value = getRateForType(primaryType.value);
  updateTotal();
});

/* יצירת משתתפים נוספים */
function createExtraParticipantCard(i) {
  const card = document.createElement("div");
  card.className = "participant-card extra";
  card.dataset.index = i;

  card.innerHTML = `
    <div class="participant-title">משתתף ${i} / Participant ${i}</div>

    <div class="row">
      <div>
        <label>שם פרטי / First Name
          <input type="text" name="fn${i}" required />
        </label>
      </div>
      <div>
        <label>שם משפחה / Last Name
          <input type="text" name="ln${i}" required />
        </label>
      </div>
    </div>

    <label>אוניברסיטה / University
      <input type="text" name="uni${i}" required />
    </label>

    <div class="row">
      <div>
        <label>סוג משתתף / Participant Type
          <select name="type${i}" class="type-select" required>
            <option value="">בחר / Select</option>
            <option value="student">סטודנט / בוגר טרי (2023+) – 300 ₪</option>
            <option value="veteran">בוגר ותיק – 360 ₪</option>
          </select>
        </label>
      </div>

      <div>
        <label>תעריף (₪) / Rate
          <input type="number" name="rate${i}" class="rate-input" readonly />
        </label>
      </div>
    </div>
  `;

  const typeSelect = card.querySelector(".type-select");
  const rateInput = card.querySelector(".rate-input");

  typeSelect.addEventListener("change", () => {
    rateInput.value = getRateForType(typeSelect.value);
    updateTotal();
  });

  return card;
}

function syncParticipants() {
  const count = parseInt(ticketCountInput.value) || 1;
  extraContainer.innerHTML = "";

  for (let i = 2; i <= count; i++) {
    extraContainer.appendChild(createExtraParticipantCard(i));
  }

  updateTotal();
}

ticketCountInput.addEventListener("change", syncParticipants);

/* חישוב סה"כ */
function updateTotal() {
  let sum = 0;
  sum += getRateForType(primaryType.value);

  document.querySelectorAll(".extra").forEach(card => {
    const type = card.querySelector(".type-select").value;
    sum += getRateForType(type);
  });

  totalAmountEl.textContent = "סה״כ: " + sum + " ₪";
}

/* שליחת רישום */
async function handleSubmit() {
  const buyer = {
    first_name: document.querySelector('[name="primary_first_name"]').value.trim(),
    last_name: document.querySelector('[name="primary_last_name"]').value.trim(),
    email: document.querySelector('[name="primary_email"]').value.trim(),
    phone: document.querySelector('[name="primary_phone"]').value.trim()
  };

  const participants = [];
  
  /* משתתף 1 */
  participants.push({
    first_name: buyer.first_name,
    last_name: buyer.last_name,
    university: document.getElementById("primary_participant_university").value.trim(),
    type: primaryType.value,
    rate: getRateForType(primaryType.value)
  });

  /* משתתפים נוספים */
  document.querySelectorAll(".extra").forEach(card => {
    const i = card.dataset.index;
    participants.push({
      first_name: card.querySelector(`[name="fn${i}"]`).value.trim(),
      last_name: card.querySelector(`[name="ln${i}"]`).value.trim(),
      university: card.querySelector(`[name="uni${i}"]`).value.trim(),
      type: card.querySelector(`[name="type${i}"]`).value,
      rate: getRateForType(card.querySelector(`[name="type${i}"]`).value)
    });
  });

  /* שליחה ל-Google Sheet */
  await fetch(SCRIPT_URL, {
    method: "POST",
    mode: "no-cors",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ buyer, participants })
  });

  alert("ההרשמה נשלחה בהצלחה! בדוק את ה־Google Sheet ואת המייל שלך.");
}

/* כפתור שליחה */
document.getElementById("submitBtn").addEventListener("click", handleSubmit);

/* הפעלה ראשונית */
syncParticipants();
</script>

</body>
</html>

