<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>גאלה 2025 | Gala 2025 - רישום</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f5f5;
      direction: rtl;
    }

    /* לוגו ברוחב הטופס */
    .logo {
      text-align: center;
      margin-bottom: 20px;
    }
    .logo img {
      width: 100%;
      max-width: 600px; /* גודל טופס */
      height: auto;
      display: block;
      margin: 0 auto;
    }

    .container {
      max-width: 900px;
      margin: 20px auto;
      background: #ffffff;
      padding: 30px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      border-radius: 8px;
    }

    h1 {
      text-align: center;
      margin: 10px 0 25px 0;
      line-height: 1.4;
    }

    h2 {
      margin-top: 25px;
      border-bottom: 1px solid #ddd;
      padding-bottom: 4px;
      font-size: 1.1rem;
    }

    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }

    input, select {
      width: 100%;
      padding: 8px;
      margin-top: 4px;
      box-sizing: border-box;
    }

    .participants { margin-top: 15px; }

    .participant-card {
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 15px;
      margin-bottom: 10px;
      background: #fafafa;
    }

    .participant-title { font-weight: bold; margin-bottom: 10px; }

    .row { display: flex; gap: 10px; flex-wrap: wrap; }
    .row > div { flex: 1; min-width: 180px; }

    .actions {
      margin-top: 25px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.95rem;
    }
    .btn-add { background: #e0e0e0; }
    .btn-submit { background: #b31b1b; color: white; }

    .note { font-size: 0.9em; color: #555; margin-top: 8px; }

    .total-amount { font-weight: bold; font-size: 1.1em; }

    .policy {
      margin-top: 25px;
      padding: 15px;
      background: #fff3cd;
      border: 1px solid #f1c40f;
      border-radius: 6px;
    }
  </style>
</head>

<body>

  <div class="container">

    <!-- לוגו -->
    <div class="logo">
      <img src="New Gala Logo 2022.png" alt="Gala Logo"/>
    </div>

    <h1>גאלה 2025<br><span style="font-size:0.9em">Gala 2025</span></h1>

    <form id="registrationForm">

      <h2>פרטי המזמין (משמשים כמשתתף 1)</h2>

      <label>שם פרטי
        <input type="text" id="buyer_first_name" required />
      </label>

      <label>שם משפחה
        <input type="text" id="buyer_last_name" required />
      </label>

      <label>דוא״ל
        <input type="email" id="buyer_email" required />
      </label>

      <label>טלפון
        <input type="tel" id="buyer_phone" />
      </label>

      <label>כמות כרטיסים
        <input type="number" id="ticketCount" min="1" value="1" required />
      </label>

      <p class="note">
        אם אתה נרשם לבד — אין צורך למלא שוב את פרטי המשתתף למטה.
      </p>

      <div class="participants">

        <div class="participant-card">
          <div class="participant-title">משתתף 1 (המזמין)</div>

          <div class="row">
            <div>
              <label>שם פרטי משתתף
                <input type="text" id="p1_first" readonly />
              </label>
            </div>

            <div>
              <label>שם משפחה משתתף
                <input type="text" id="p1_last" readonly />
              </label>
            </div>
          </div>

          <label>אוניברסיטה
            <input type="text" id="p1_uni" required />
          </label>

          <div class="row">
            <div>
              <label>סוג כרטיס
                <select id="p1_type" required>
                  <option value="">בחר</option>
                  <option value="fresh">בוגר טרי – 300 ₪</option>
                  <option value="veteran">בוגר ותיק – 360 ₪</option>
                </select>
              </label>
            </div>

            <div>
              <label>תעריף (₪)
                <input type="number" id="p1_rate" readonly />
              </label>
            </div>
          </div>
        </div>

        <div id="extraParticipants"></div>

      </div>

      <div class="actions">
        <button type="button" class="btn btn-add" id="addParticipantBtn">הוסף משתתף</button>
        <div id="totalAmount">סה״כ: 0 ₪</div>
        <button type="button" class="btn btn-submit" id="submitBtn">שליחת רישום</button>
      </div>

      <div class="policy">
        <strong>דמי ביטול:</strong><br>
        ביטול עד 72 שעות לפני האירוע – 6% דמי ביטול.<br>
        ביטול בתוך 72 שעות – אין החזרים.
      </div>

    </form>
  </div>

<script>
const SCRIPT_URL =
  "https://script.google.com/macros/s/AKfycbw5TakrE1_W_x7tM5IdrA8iuvrveYChiiwh54TjKEdOiXxJa98cmw6hssdCh1TGEzQS/exec";

function getRate(t) { return t === "fresh" ? 300 : t === "veteran" ? 360 : 0; }

const buyerFirst = document.getElementById("buyer_first_name");
const buyerLast  = document.getElementById("buyer_last_name");
const p1First    = document.getElementById("p1_first");
const p1Last     = document.getElementById("p1_last");

buyerFirst.addEventListener("input", ()=> p1First.value = buyerFirst.value);
buyerLast.addEventListener("input", ()=> p1Last.value  = buyerLast.value);

document.getElementById("p1_type").addEventListener("change", e=>{
  document.getElementById("p1_rate").value = getRate(e.target.value);
  updateTotal();
});

function updateTotal() {
  let sum = getRate(document.getElementById("p1_type").value);
  document.querySelectorAll(".extra").forEach(card=>{
    const type = card.querySelector(".ptype").value;
    sum += getRate(type);
  });
  document.getElementById("totalAmount").innerText = "סה״כ: " + sum + " ₪";
}

function addParticipant(i){
  const div = document.createElement("div");
  div.className = "participant-card extra";
  div.innerHTML = `
    <div class="participant-title">משתתף ${i}</div>
    <div class="row">
      <div><label>שם פרטי<input type="text" class="pfirst" required></label></div>
      <div><label>שם משפחה<input type="text" class="plast" required></label></div>
    </div>
    <label>אוניברסיטה<input type="text" class="puni" required></label>
    <div class="row">
      <div>
        <label>סוג כרטיס
          <select class="ptype" required>
            <option value="">בחר</option>
            <option value="fresh">בוגר טרי – 300 ₪</option>
            <option value="veteran">בוגר ותיק – 360 ₪</option>
          </select>
        </label>
      </div>
      <div>
        <label>תעריף
          <input type="number" class="prate" readonly>
        </label>
      </div>
    </div>`;
  
  div.querySelector(".ptype").addEventListener("change", e=>{
    div.querySelector(".prate").value = getRate(e.target.value);
    updateTotal();
  });

  document.getElementById("extraParticipants").appendChild(div);
}

document.getElementById("addParticipantBtn").onclick = ()=>{
  const count = document.querySelectorAll(".extra").length + 2;
  addParticipant(count);
  updateTotal();
};

document.getElementById("submitBtn").onclick = async ()=>{
  const buyer = {
    first_name: buyerFirst.value.trim(),
    last_name:  buyerLast.value.trim(),
    email:      document.getElementById("buyer_email").value.trim(),
    phone:      document.getElementById("buyer_phone").value.trim()
  };

  const participants = [{
    first_name: p1First.value.trim(),
    last_name:  p1Last.value.trim(),
    university: document.getElementById("p1_uni").value.trim(),
    type:       document.getElementById("p1_type").value,
    rate:       getRate(document.getElementById("p1_type").value)
  }];

  document.querySelectorAll(".extra").forEach(card=>{
    participants.push({
      first_name: card.querySelector(".pfirst").value.trim(),
      last_name:  card.querySelector(".plast").value.trim(),
      university: card.querySelector(".puni").value.trim(),
      type:       card.querySelector(".ptype").value,
      rate:       getRate(card.querySelector(".ptype").value)
    });
  });

  await fetch(SCRIPT_URL, {
    method:"POST",
    mode:"no-cors",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({ buyer, participants })
  });

  alert("ההרשמה נשלחה!");
};

updateTotal();
</script>

</body>
</html>
